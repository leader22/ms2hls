<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>MediaStream2HttpLiveStreaming Viewer</title>
  <link rel="stylesheet" href="./main.css">
</head>
<body>
  <a href="./reporter.html">reporter</a> | <a href="./recorder.html">recorder</a> | viewer
  <hr>
  <h3>Watch it</h3>
  <video controls></video>
  <div>
    <input type="text" size="80">
    <button>Play stream</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const $video = document.querySelector('video');
    const $streamUrl = document.querySelector('input');
    const $playBtn = document.querySelector('button');

    $playBtn.onclick = () => {
      const url = $streamUrl.value;

      if (!url) {
        console.error('url is empty!');
        return;
      }

      const play = isSafari() ? playHLS : playHLSjs;
      play(url, $video);
    };

    function playHLSjs(url, $video) {
      const hls = new Hls();
      hls.attachMedia($video);

      hls.loadSource(url);
      hls.on(Hls.Events.MANIFEST_PARSED, () => {
        $video.play();
      });
    }

    function playHLS(url, $video) {
      $video.src = url;
      $video.play();
    }

    function isSafari() {
      const { userAgent } = navigator
      const chrome = userAgent.indexOf('Chrome') > -1
      const safari = userAgent.indexOf('Safari') > -1

      return chrome === false && safari
    }
  </script>
</body>
</html>
